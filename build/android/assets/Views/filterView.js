module.exports = function (_$) {

  const $ = _$;
  var active = false;
  function getHeaderView(label) {
    const v = Ti.UI.createView({
      top: 0,
      height: 20,
      zIndex: 999,
      backgroundColor: 'grey' });

    v.add(Ti.UI.createLabel({
      textAlign: 'left',
      text: label,
      color: "white",
      font: {
        fontSize: 12.5,
        fontWeight: 'bold' },

      left: 5,
      width: Ti.UI.FILL }));

    return v;
  };
  const View = Ti.UI.createView({
    right: -240,
    width: 240,
    backgroundColor: "#4E7985",
    active: false,
    layout: "vertical" });

  View.needleView = Ti.UI.createTextField({
    width: Ti.UI.FILL,
    top: 0,
    height: 45,
    hintText: "Suchbegriff",
    value: "",
    backgroundColor: '#659BAC',
    height: 45 });

  View.add(View.needleView);
  View.slideIn = function () {
    View.animate({
      right: 0 },
    function () {
      View.active = true;
    });

  };
  View.slideOut = function () {
    View.animate({
      right: -500 },
    function () {
      View.active = false;
    });
  };
  View.slideToggle = function () {
    if (View.active === false)
    View.slideIn();else

    View.slideOut();
  };
  const Facets = [{
    name: "collection",
    title: "Sammlung",
    display: true },
  {
    name: "language",
    title: "Sprache",
    display: true },
  {
    name: "creatorName_facet",
    title: "Autor/in",
    display: true }];


  Facets.forEach(function (f) {
    $.Solr.addFacetField(f.name);
  });
  $.Solr.addFacetField("publicationYear");
  $.Solr.addFacetField("identifier");
  $.Solr.addFacetField("identifierType");
  const FacetsForList = Facets.filter(function (f) {
    return f.display;
  });

  // Histogramm
  View.histo = require("Views/histogramView")();

  // Facetten:
  View.tv = Ti.UI.createListView({
    top: 0,
    templates: {
      'facets': require("Views/TEMPLATES").facets },

    defaultItemTemplate: 'facets',
    sections: Facets.map(function (f, i) {
      return Ti.UI.createListSection({
        headerView: i > 0 ? getHeaderView(f.title) : undefined,
        name: f.name });

    }) });

  View.add(getHeaderView("Erscheinungsjahr"));
  var stickyHeaderView = getHeaderView(Facets[0].title);
  View.add(View.histo);
  View.add(stickyHeaderView);
  View.add(View.tv);

  View.tv.addEventListener("scrollend", function (e) {
    stickyHeaderView.children[0].setText(Facets[e.firstVisibleSectionIndex].title);
  });
  View.tv.addEventListener('itemclick', function (e) {
    //var item = e.section.getItemAt(e.itemIndex);
    $.Solr.toggleFacet(e.section.name + ':"' + e.itemId + '"');
    $.updateList();
  });
  function getLang(foo) {
    switch (foo) {
      case "de":
        return "ðŸ‡©ðŸ‡ª Deutsch";
      case "en":
        return "ðŸ‡¬ðŸ‡§ Englisch";
      case "fr":
        return "ðŸ‡«ðŸ‡· FranzÃ¶sisch";
      case "es":
        return "ðŸ‡ªðŸ‡¸ Kastillisch";
      case "ru":
        return "ðŸ‡·ðŸ‡º Russisch";
      case "it":
        return "ðŸ‡®ðŸ‡¹ Italienisch";
      case "pl":
        return "ðŸ‡µðŸ‡± Polnisch";
      case "pt":
        return "ðŸ‡µðŸ‡¹ Portugisisch";
      case "nl":
        return "ðŸ‡³ðŸ‡± NiederlÃ¤ndisch";
      case "zh":
        return "ðŸ‡¨ðŸ‡³ Mandarin";
      case "el":
        return "ðŸ‡¬ðŸ‡· Griechisch";
      case "tk":
        return "ðŸ‡¹ðŸ‡· TÃ¼rkisch";
      case "no":
        return "ðŸ‡³ðŸ‡´ Norwegisch";
      case "fin":
        return "ðŸ‡«ðŸ‡® Finnisch";
      case "ja":
        return "ðŸ‡¯ðŸ‡µ Japanisch";
      case "por":
        return "ðŸ‡µðŸ‡¹ Portugiesisch";
      default:
        return foo;}


  }


  View.setFacets = function (facetdata) {
    View.histo.setData(facetdata.publicationYear);
    View.histo.renderCanvas();

    Facets.forEach(function (f, i) {
      const items = [];
      facetdata[f.name].forEach(function (val) {
        if (f.name == "language")
        val.k = val.k.toLowerCase();
        if (val.v)
        items.push({
          properties: {
            itemId: val.k,
            active: false },

          label: {
            text: f.name == 'language' ? getLang(val.k) : val.k },

          count: {
            text: val.v },

          active: {
            visible: $.Solr.hasFacet(val.k) } });


      });
      View.tv.sections[i].setItems(items);
    });
  };
  return View;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbHRlclZpZXcuanMiXSwibmFtZXMiOlsibW9kdWxlIiwiZXhwb3J0cyIsIl8kIiwiJCIsImFjdGl2ZSIsImdldEhlYWRlclZpZXciLCJsYWJlbCIsInYiLCJUaSIsIlVJIiwiY3JlYXRlVmlldyIsInRvcCIsImhlaWdodCIsInpJbmRleCIsImJhY2tncm91bmRDb2xvciIsImFkZCIsImNyZWF0ZUxhYmVsIiwidGV4dEFsaWduIiwidGV4dCIsImNvbG9yIiwiZm9udCIsImZvbnRTaXplIiwiZm9udFdlaWdodCIsImxlZnQiLCJ3aWR0aCIsIkZJTEwiLCJWaWV3IiwicmlnaHQiLCJsYXlvdXQiLCJuZWVkbGVWaWV3IiwiY3JlYXRlVGV4dEZpZWxkIiwiaGludFRleHQiLCJ2YWx1ZSIsInNsaWRlSW4iLCJhbmltYXRlIiwic2xpZGVPdXQiLCJzbGlkZVRvZ2dsZSIsIkZhY2V0cyIsIm5hbWUiLCJ0aXRsZSIsImRpc3BsYXkiLCJmb3JFYWNoIiwiZiIsIlNvbHIiLCJhZGRGYWNldEZpZWxkIiwiRmFjZXRzRm9yTGlzdCIsImZpbHRlciIsImhpc3RvIiwicmVxdWlyZSIsInR2IiwiY3JlYXRlTGlzdFZpZXciLCJ0ZW1wbGF0ZXMiLCJmYWNldHMiLCJkZWZhdWx0SXRlbVRlbXBsYXRlIiwic2VjdGlvbnMiLCJtYXAiLCJpIiwiY3JlYXRlTGlzdFNlY3Rpb24iLCJoZWFkZXJWaWV3IiwidW5kZWZpbmVkIiwic3RpY2t5SGVhZGVyVmlldyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiY2hpbGRyZW4iLCJzZXRUZXh0IiwiZmlyc3RWaXNpYmxlU2VjdGlvbkluZGV4IiwidG9nZ2xlRmFjZXQiLCJzZWN0aW9uIiwiaXRlbUlkIiwidXBkYXRlTGlzdCIsImdldExhbmciLCJmb28iLCJzZXRGYWNldHMiLCJmYWNldGRhdGEiLCJzZXREYXRhIiwicHVibGljYXRpb25ZZWFyIiwicmVuZGVyQ2FudmFzIiwiaXRlbXMiLCJ2YWwiLCJrIiwidG9Mb3dlckNhc2UiLCJwdXNo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QixRQUFwQixDQUE2QlQsS0FBN0I7QUFDQSxLQXZCRDtBQXdCQSxHQTVCRDtBQTZCQSxTQUFPbkQsSUFBUDtBQUNBLENBNUxEIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihfJCkge1xuXG5cdGNvbnN0ICQgPSBfJDtcblx0dmFyIGFjdGl2ZSA9IGZhbHNlO1xuXHRmdW5jdGlvbiBnZXRIZWFkZXJWaWV3KGxhYmVsKSB7XG5cdFx0Y29uc3QgdiA9IFRpLlVJLmNyZWF0ZVZpZXcoe1xuXHRcdFx0dG9wIDogMCxcblx0XHRcdGhlaWdodCA6IDIwLFxuXHRcdFx0ekluZGV4IDogOTk5LFxuXHRcdFx0YmFja2dyb3VuZENvbG9yIDogJ2dyZXknXG5cdFx0fSk7XG5cdFx0di5hZGQoVGkuVUkuY3JlYXRlTGFiZWwoe1xuXHRcdFx0dGV4dEFsaWduIDogJ2xlZnQnLFxuXHRcdFx0dGV4dCA6IGxhYmVsLFxuXHRcdFx0Y29sb3IgOiBcIndoaXRlXCIsXG5cdFx0XHRmb250IDoge1xuXHRcdFx0XHRmb250U2l6ZSA6IDEyLjVcdCxcblx0XHRcdFx0Zm9udFdlaWdodCA6ICdib2xkJ1xuXHRcdFx0fSxcblx0XHRcdGxlZnQgOiA1LFxuXHRcdFx0d2lkdGggOiBUaS5VSS5GSUxMXG5cdFx0fSkpO1xuXHRcdHJldHVybiB2O1xuXHR9O1xuXHRjb25zdCBWaWV3ID0gVGkuVUkuY3JlYXRlVmlldyh7XG5cdFx0cmlnaHQgOiAtMjQwLFxuXHRcdHdpZHRoIDogMjQwLFxuXHRcdGJhY2tncm91bmRDb2xvciA6IFwiIzRFNzk4NVwiLFxuXHRcdGFjdGl2ZSA6IGZhbHNlLFxuXHRcdGxheW91dCA6IFwidmVydGljYWxcIlxuXHR9KTtcblx0Vmlldy5uZWVkbGVWaWV3ID0gVGkuVUkuY3JlYXRlVGV4dEZpZWxkKHtcblx0XHR3aWR0aCA6IFRpLlVJLkZJTEwsXG5cdFx0dG9wIDogMCxcblx0XHRoZWlnaHQgOiA0NSxcblx0XHRoaW50VGV4dCA6IFwiU3VjaGJlZ3JpZmZcIixcblx0XHR2YWx1ZSA6IFwiXCIsXG5cdFx0YmFja2dyb3VuZENvbG9yIDogJyM2NTlCQUMnLFxuXHRcdGhlaWdodCA6IDQ1XG5cdH0pO1xuXHRWaWV3LmFkZChWaWV3Lm5lZWRsZVZpZXcpO1xuXHRWaWV3LnNsaWRlSW4gPSBmdW5jdGlvbigpIHtcblx0XHRWaWV3LmFuaW1hdGUoe1xuXHRcdFx0cmlnaHQgOiAwXG5cdFx0fSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRWaWV3LmFjdGl2ZSA9IHRydWU7XG5cdFx0fSk7XG5cblx0fTtcblx0Vmlldy5zbGlkZU91dCA9IGZ1bmN0aW9uKCkge1xuXHRcdFZpZXcuYW5pbWF0ZSh7XG5cdFx0XHRyaWdodCA6IC01MDBcblx0XHR9LCBmdW5jdGlvbigpIHtcblx0XHRcdFZpZXcuYWN0aXZlID0gZmFsc2U7XG5cdFx0fSk7XG5cdH07XG5cdFZpZXcuc2xpZGVUb2dnbGUgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAoVmlldy5hY3RpdmUgPT09IGZhbHNlKVxuXHRcdFx0Vmlldy5zbGlkZUluKCk7XG5cdFx0ZWxzZVxuXHRcdFx0Vmlldy5zbGlkZU91dCgpO1xuXHR9O1xuXHRjb25zdCBGYWNldHMgPSBbe1xuXHRcdG5hbWUgOiBcImNvbGxlY3Rpb25cIixcblx0XHR0aXRsZSA6IFwiU2FtbWx1bmdcIixcblx0XHRkaXNwbGF5IDogdHJ1ZVxuXHR9LCB7XG5cdFx0bmFtZSA6IFwibGFuZ3VhZ2VcIixcblx0XHR0aXRsZSA6IFwiU3ByYWNoZVwiLFxuXHRcdGRpc3BsYXkgOiB0cnVlXG5cdH0sIHtcblx0XHRuYW1lIDogXCJjcmVhdG9yTmFtZV9mYWNldFwiLFxuXHRcdHRpdGxlIDogXCJBdXRvci9pblwiLFxuXHRcdGRpc3BsYXkgOiB0cnVlXG5cdH1dO1xuXG5cdEZhY2V0cy5mb3JFYWNoKGZ1bmN0aW9uKGYpIHtcblx0XHQkLlNvbHIuYWRkRmFjZXRGaWVsZChmLm5hbWUpO1xuXHR9KTtcblx0JC5Tb2xyLmFkZEZhY2V0RmllbGQoXCJwdWJsaWNhdGlvblllYXJcIik7XG5cdCQuU29sci5hZGRGYWNldEZpZWxkKFwiaWRlbnRpZmllclwiKTtcblx0JC5Tb2xyLmFkZEZhY2V0RmllbGQoXCJpZGVudGlmaWVyVHlwZVwiKTtcblx0Y29uc3QgRmFjZXRzRm9yTGlzdCA9IEZhY2V0cy5maWx0ZXIoZnVuY3Rpb24oZikge1xuXHRcdHJldHVybiBmLmRpc3BsYXk7XG5cdH0pO1xuXG5cdC8vIEhpc3RvZ3JhbW1cblx0Vmlldy5oaXN0byA9IHJlcXVpcmUoXCJWaWV3cy9oaXN0b2dyYW1WaWV3XCIpKCk7XG5cblx0Ly8gRmFjZXR0ZW46XG5cdFZpZXcudHYgPSBUaS5VSS5jcmVhdGVMaXN0Vmlldyh7XG5cdFx0dG9wIDogMCxcblx0XHR0ZW1wbGF0ZXMgOiB7XG5cdFx0XHQnZmFjZXRzJyA6IHJlcXVpcmUoXCJWaWV3cy9URU1QTEFURVNcIikuZmFjZXRzXG5cdFx0fSxcblx0XHRkZWZhdWx0SXRlbVRlbXBsYXRlIDogJ2ZhY2V0cycsXG5cdFx0c2VjdGlvbnMgOiBGYWNldHMubWFwKGZ1bmN0aW9uKGYsaSkge1xuXHRcdFx0cmV0dXJuIFRpLlVJLmNyZWF0ZUxpc3RTZWN0aW9uKHtcblx0XHRcdFx0aGVhZGVyVmlldyA6IChpPjApP2dldEhlYWRlclZpZXcoZi50aXRsZSk6dW5kZWZpbmVkLFxuXHRcdFx0XHRuYW1lIDogZi5uYW1lXG5cdFx0XHR9KTtcblx0XHR9KVxuXHR9KTtcblx0Vmlldy5hZGQoZ2V0SGVhZGVyVmlldyhcIkVyc2NoZWludW5nc2phaHJcIikpO1xuXHR2YXIgc3RpY2t5SGVhZGVyVmlldyA9IGdldEhlYWRlclZpZXcoRmFjZXRzWzBdLnRpdGxlKTtcblx0Vmlldy5hZGQoVmlldy5oaXN0byk7XG5cdFZpZXcuYWRkKHN0aWNreUhlYWRlclZpZXcpO1xuXHRWaWV3LmFkZChWaWV3LnR2KTtcblxuXHRWaWV3LnR2LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxlbmRcIiwgZnVuY3Rpb24oZSkge1xuXHRcdHN0aWNreUhlYWRlclZpZXcuY2hpbGRyZW5bMF0uc2V0VGV4dChGYWNldHNbZS5maXJzdFZpc2libGVTZWN0aW9uSW5kZXhdLnRpdGxlKTtcblx0fSk7XG5cdFZpZXcudHYuYWRkRXZlbnRMaXN0ZW5lcignaXRlbWNsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdC8vdmFyIGl0ZW0gPSBlLnNlY3Rpb24uZ2V0SXRlbUF0KGUuaXRlbUluZGV4KTtcblx0XHQkLlNvbHIudG9nZ2xlRmFjZXQoZS5zZWN0aW9uLm5hbWUgKyAnOlwiJyArIGUuaXRlbUlkICsgJ1wiJyk7XG5cdFx0JC51cGRhdGVMaXN0KCk7XG5cdH0pO1xuXHRmdW5jdGlvbiBnZXRMYW5nKGZvbykge1xuXHRcdHN3aXRjaCAoZm9vKSB7XG5cdFx0Y2FzZSBcImRlXCI6XG5cdFx0XHRyZXR1cm4gXCLwn4ep8J+HqiBEZXV0c2NoXCI7XG5cdFx0Y2FzZSBcImVuXCIgOlxuXHRcdFx0cmV0dXJuIFwi8J+HrPCfh6cgRW5nbGlzY2hcIjtcblx0XHRjYXNlIFwiZnJcIiA6XG5cdFx0XHRyZXR1cm4gXCLwn4er8J+HtyBGcmFuesO2c2lzY2hcIjtcblx0XHRjYXNlIFwiZXNcIiA6XG5cdFx0XHRyZXR1cm4gXCLwn4eq8J+HuCBLYXN0aWxsaXNjaFwiO1xuXHRcdGNhc2UgXCJydVwiIDpcblx0XHRcdHJldHVybiBcIvCfh7fwn4e6IFJ1c3Npc2NoXCI7XG5cdFx0Y2FzZSBcIml0XCIgOlxuXHRcdFx0cmV0dXJuIFwi8J+HrvCfh7kgSXRhbGllbmlzY2hcIjtcblx0XHRjYXNlIFwicGxcIiA6XG5cdFx0XHRyZXR1cm4gXCLwn4e18J+HsSBQb2xuaXNjaFwiO1xuXHRcdGNhc2UgXCJwdFwiIDpcblx0XHRcdHJldHVybiBcIvCfh7Xwn4e5IFBvcnR1Z2lzaXNjaFwiO1xuXHRcdGNhc2UgXCJubFwiIDpcblx0XHRcdHJldHVybiBcIvCfh7Pwn4exIE5pZWRlcmzDpG5kaXNjaFwiO1xuXHRcdGNhc2UgXCJ6aFwiIDpcblx0XHRcdHJldHVybiBcIvCfh6jwn4ezIE1hbmRhcmluXCI7XG5cdFx0Y2FzZSBcImVsXCIgOlxuXHRcdFx0cmV0dXJuIFwi8J+HrPCfh7cgR3JpZWNoaXNjaFwiO1xuXHRcdGNhc2UgXCJ0a1wiIDpcblx0XHRcdHJldHVybiBcIvCfh7nwn4e3IFTDvHJraXNjaFwiO1xuXHRcdGNhc2UgXCJub1wiIDpcblx0XHRcdHJldHVybiBcIvCfh7Pwn4e0IE5vcndlZ2lzY2hcIjtcblx0XHRjYXNlIFwiZmluXCIgOlxuXHRcdFx0cmV0dXJuIFwi8J+Hq/Cfh64gRmlubmlzY2hcIjtcblx0XHRjYXNlIFwiamFcIiA6XG5cdFx0XHRyZXR1cm4gXCLwn4ev8J+HtSBKYXBhbmlzY2hcIjtcblx0XHRjYXNlIFwicG9yXCIgOlxuXHRcdFx0cmV0dXJuIFwi8J+HtfCfh7kgUG9ydHVnaWVzaXNjaFwiO1xuXHRcdGRlZmF1bHQgOlxuXHRcdFx0cmV0dXJuIGZvbztcblx0XHR9XG5cblx0fVxuXG5cblx0Vmlldy5zZXRGYWNldHMgPSBmdW5jdGlvbihmYWNldGRhdGEpIHtcblx0XHRWaWV3Lmhpc3RvLnNldERhdGEoZmFjZXRkYXRhLnB1YmxpY2F0aW9uWWVhcik7XG5cdFx0Vmlldy5oaXN0by5yZW5kZXJDYW52YXMoKTtcblxuXHRcdEZhY2V0cy5mb3JFYWNoKGZ1bmN0aW9uKGYsIGkpIHtcblx0XHRcdGNvbnN0IGl0ZW1zID0gW107XG5cdFx0XHRmYWNldGRhdGFbZi5uYW1lXS5mb3JFYWNoKGZ1bmN0aW9uKHZhbCkge1xuXHRcdFx0XHRpZiAoZi5uYW1lID09IFwibGFuZ3VhZ2VcIilcblx0XHRcdFx0XHR2YWwuayA9IHZhbC5rLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdGlmICh2YWwudilcblx0XHRcdFx0XHRpdGVtcy5wdXNoKHtcblx0XHRcdFx0XHRcdHByb3BlcnRpZXMgOiB7XG5cdFx0XHRcdFx0XHRcdGl0ZW1JZCA6IHZhbC5rLFxuXHRcdFx0XHRcdFx0XHRhY3RpdmUgOiBmYWxzZVxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGxhYmVsIDoge1xuXHRcdFx0XHRcdFx0XHR0ZXh0IDogKGYubmFtZSA9PSAnbGFuZ3VhZ2UnKSA/IGdldExhbmcodmFsLmspIDogdmFsLmtcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRjb3VudCA6IHtcblx0XHRcdFx0XHRcdFx0dGV4dCA6IHZhbC52XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0YWN0aXZlIDoge1xuXHRcdFx0XHRcdFx0XHR2aXNpYmxlIDogJC5Tb2xyLmhhc0ZhY2V0KHZhbC5rKVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0XHRWaWV3LnR2LnNlY3Rpb25zW2ldLnNldEl0ZW1zKGl0ZW1zKTtcblx0XHR9KTtcblx0fTtcblx0cmV0dXJuIFZpZXc7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvZnVlcnN0L0RvY3VtZW50cy9NTGVhcm5pbmcvU2NoYXVmZW5zdGVyL1Jlc291cmNlcy9WaWV3cyJ9
